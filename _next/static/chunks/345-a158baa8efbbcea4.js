(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[345],{34155:function(e){var t,n,r,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l=[],u=!1,c=-1;function h(){u&&r&&(u=!1,r.length?l=r.concat(l):c=-1,l.length&&d())}function d(){if(!u){var e=a(h);u=!0;for(var t=l.length;t;){for(r=l,l=[];++c<t;)r&&r[c].run();c=-1,t=l.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||u||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}},96600:function(e,t,n){"use strict";n.d(t,{z:function(){return L}});var r=n(67294),s=n(74250),i=n(15319),o=n(60701),a=n(24591),l=Object.defineProperty,u=(e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t,n)=>(u(e,"symbol"!=typeof t?t+"":t,n),n);let h={Handedness:{NONE:"none",LEFT:"left",RIGHT:"right"},ComponentState:{DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},ComponentProperty:{BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},ComponentType:{TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"},ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:{TRANSFORM:"transform",VISIBILITY:"visibility"}};async function d(e){let t=await fetch(e);if(t.ok)return t.json();throw Error(t.statusText)}async function p(e){if(!e)throw Error("No basePath supplied");let t=await d(`${e}/profilesList.json`);return t}async function m(e,t,n=null,r=!0){let s,i;if(!e)throw Error("No xrInputSource supplied");if(!t)throw Error("No basePath supplied");let o=await p(t);if(e.profiles.some(e=>{let n=o[e];return n&&(s={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!s}),!s){if(!n)throw Error("No matching profile name found");let e=o[n];if(!e)throw Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}let a=await d(s.profilePath);if(r){let t;if(!(t="any"===e.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[e.handedness]))throw Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(i=s.profilePath.replace("profile.json",t.assetPath))}return{profile:a,assetPath:i}}let f={xAxis:0,yAxis:0,button:0,state:h.ComponentState.DEFAULT};class g{constructor(e){c(this,"value"),c(this,"componentProperty"),c(this,"states"),c(this,"valueNodeName"),c(this,"valueNodeProperty"),c(this,"minNodeName"),c(this,"maxNodeName"),c(this,"valueNode"),c(this,"minNode"),c(this,"maxNode"),this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===h.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(f)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:r}){let{normalizedXAxis:s,normalizedYAxis:i}=function(e=0,t=0){let n=e,r=t;if(Math.sqrt(e*e+t*t)>1){let s=Math.atan2(t,e);n=Math.cos(s),r=Math.sin(s)}let s={normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5};return s}(e,t);switch(this.componentProperty){case h.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case h.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?i:.5;break;case h.ComponentProperty.BUTTON:this.value=this.states.includes(r)&&n?n:0;break;case h.ComponentProperty.STATE:this.valueNodeProperty===h.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class v{constructor(e,t){if(c(this,"id"),c(this,"values"),c(this,"type"),c(this,"gamepadIndices"),c(this,"rootNodeName"),c(this,"visualResponses"),c(this,"touchPointNodeName"),c(this,"touchPointNode"),!e||!t||!t.visualResponses||!t.gamepadIndices||0===Object.keys(t.gamepadIndices).length)throw Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{let n=new g(t.visualResponses[e]);this.visualResponses[e]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:h.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){let e={id:this.id,...this.values};return e}updateFromGamepad(e){if(this.values.state=h.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=h.ComponentState.PRESSED:(t.touched||this.values.button>h.ButtonTouchThreshold)&&(this.values.state=h.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===h.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>h.AxisTouchThreshold&&(this.values.state=h.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===h.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>h.AxisTouchThreshold&&(this.values.state=h.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class A{constructor(e,t,n){if(c(this,"xrInputSource"),c(this,"assetUrl"),c(this,"layoutDescription"),c(this,"id"),c(this,"components"),!e)throw Error("No xrInputSource supplied");if(!t)throw Error("No profile supplied");if(!t.layouts[e.handedness])throw Error("No layout for "+e.handedness+" handedness");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{let t=this.layoutDescription.components[e];this.components[e]=new v(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}let x=e=>"envMap"in e,T=(e,t)=>{e.envMap=t,e.needsUpdate=!0},E=(e,t)=>{t instanceof s.Kj0&&(Array.isArray(t.material)?t.material.forEach(t=>x(t)?T(t,e):void 0):x(t.material)&&T(t.material,e))},y=e=>"envMapIntensity"in e,R=(e,t)=>{e.envMapIntensity=t,e.needsUpdate=!0},S=(e,t)=>{t instanceof s.Kj0&&(Array.isArray(t.material)?t.material.forEach(t=>y(t)?R(t,e):void 0):y(t.material)&&R(t.material,e))};class w extends s.ZAu{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(e,t=1){var n;return this.envMap===e&&this.envMapIntensity===t||(this.envMap=e,this.envMapIntensity=t,null==(n=this.scene)||n.traverse(n=>{E(e,n),S(t,n)})),this}setEnvironmentMapIntensity(e){var t;return this.envMapIntensity===e||(this.envMapIntensity=e,null==(t=this.scene)||t.traverse(t=>S(e,t))),this}connectModel(e){var t;if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=e,t=this,function(e,t){Object.values(e.components).forEach(e=>{let{type:n,touchPointNodeName:r,visualResponses:i}=e;if(n===h.ComponentType.TOUCHPAD&&r){if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){let t=new s.xo$(.001),n=new s.vBJ({color:255}),r=new s.Kj0(t,n);e.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`)}Object.values(i).forEach(e=>{let{valueNodeName:n,minNodeName:r,maxNodeName:s,valueNodeProperty:i}=e;if(i===h.VisualResponseProperty.TRANSFORM&&r&&s){if(e.minNode=t.getObjectByName(r),e.maxNode=t.getObjectByName(s),!e.minNode){console.warn(`Could not find ${r} in the model`);return}if(!e.maxNode){console.warn(`Could not find ${s} in the model`);return}}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)})})}(t.motionController,e),(t.envMap||null!=t.envMapIntensity)&&e.traverse(e=>{t.envMap&&E(t.envMap,e),null!=t.envMapIntensity&&S(t.envMapIntensity,e)}),t.add(e),this.dispatchEvent({type:"modelconnected",data:e})}connectMotionController(e){this.motionController=e,this.dispatchEvent({type:"motionconnected",data:e})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{let{valueNode:t,minNode:n,maxNode:r,value:s,valueNodeProperty:i}=e;t&&(i===h.VisualResponseProperty.VISIBILITY&&"boolean"==typeof s?t.visible=s:i===h.VisualResponseProperty.TRANSFORM&&n&&r&&"number"==typeof s&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,s),t.position.lerpVectors(n.position,r.position,s)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}var b=n(20898);let _=r.forwardRef(function({target:e,hideOnBlur:t=!1,...n},a){let l=(0,o.nH)(e=>e.hoverState),u=r.useRef(null),c=r.useMemo(()=>new s.u9r().setFromPoints([new s.Pa4(0,0,0),new s.Pa4(0,0,-1)]),[]);return r.useImperativeHandle(a,()=>u.current),(0,i.F)(()=>{if(!e.inputSource)return;let n=1,r=l[e.inputSource.handedness].values().next().value;r&&"none"!==e.inputSource.handedness?(n=r.distance,t&&(u.current.visible=!1)):t&&(u.current.visible=!0),u.current.scale.z=n+-.01}),r.createElement("line",{ref:u,geometry:c,"material-opacity":.8,"material-transparent":!0,...n})}),I=new class{constructor(e=null,t="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles"){this.gltfLoader=null!=e?e:new a.E,this.path=t,this._assetCache={}}initializeControllerModel(e,t){return"tracked-pointer"===t.targetRayMode&&t.gamepad?m(t,this.path,"generic-trigger").then(({profile:n,assetPath:r})=>{if(!r)throw Error("no asset path");let s=new A(t,n,r);e.connectMotionController(s);let i=s.assetUrl,o=this._assetCache[i];if(o){let t=o.scene.clone();e.connectModel(t)}else{if(!this.gltfLoader)throw Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i,t=>{if(!e.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[i]=t;let n=t.scene.clone();e.connectModel(n)},void 0,()=>{throw Error(`Asset ${i} missing or malformed.`)})}}).catch(e=>{console.warn(e)}):Promise.resolve()}},M=({target:e,envMap:t,envMapIntensity:n})=>{let s=r.useRef(null),i=(0,b.W6)(e=>{null!=t&&e.setEnvironmentMap(t)}),o=(0,b.W6)(e=>e.setEnvironmentMap(null)),a=(0,b.W6)(e=>{null!=n&&e.setEnvironmentMapIntensity(n)}),l=r.useCallback(t=>{var n,r,o;if(s.current=t,t){if(e.xrControllerModel=t,null==(n=e.inputSource)?void 0:n.hand)return;i.current(t),a.current(t),e.inputSource?I.initializeControllerModel(t,e.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if(null==(r=e.inputSource)?void 0:r.hand)return;null==(o=e.xrControllerModel)||o.disconnect(),e.xrControllerModel=null}},[e,a,i]);return r.useLayoutEffect(()=>{s.current&&(t?i.current(s.current):o.current(s.current))},[t,i,o]),r.useLayoutEffect(()=>{s.current&&a.current(s.current)},[n,a]),r.createElement("xRControllerModel",{ref:l})};function L({rayMaterial:e={},hideRaysOnBlur:t=!1,envMap:n,envMapIntensity:s}){let a=(0,o.nH)(e=>e.controllers),l=(0,o.nH)(e=>e.isHandTracking),u=r.useMemo(()=>Object.entries(e).reduce((e,[t,n])=>({...e,[`material-${t}`]:n}),{}),[JSON.stringify(e)]);return r.useMemo(()=>(0,i.e)({XRControllerModel:w}),[]),r.createElement(r.Fragment,null,a.map((e,o)=>r.createElement(r.Fragment,{key:o},(0,i.h)(r.createElement(M,{target:e,envMap:n,envMapIntensity:s}),e.grip),(0,i.h)(r.createElement(_,{visible:!l,hideOnBlur:t,target:e,...u}),e.controller))))}},93823:function(e,t,n){"use strict";n.d(t,{D:function(){return h}});var r=n(67294),s=n(15319),i=n(74250),o=n(24591);class a{constructor(e,t,n="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",r,s){this.controller=t,this.handModel=e,this.bones=[];let i=new o.E;s||i.setPath(n),i.load(null!=s?s:`${r}.glb`,e=>{let t=e.scene.children[0];this.handModel.add(t),this.scene=t;let n=t.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(e=>{let n=t.getObjectByName(e);void 0!==n?n.jointName=e:console.warn(`Couldn't find ${e} in ${r} hand mesh`),this.bones.push(n)})})}updateMesh(){let e=this.controller.joints,t=!0;for(let n=0;n<this.bones.length;n++){let r=this.bones[n];if(r){let n=e[r.jointName];if(n.visible){let e=n.position;r.position.copy(e),r.quaternion.copy(n.quaternion),t=!1}}}t&&this.scene?this.scene.visible=!1:this.scene&&(this.scene.visible=!0)}dispose(){this.scene&&this.handModel.remove(this.scene)}}class l extends i.Tme{constructor(e,t,n){super(),this._onConnected=e=>{let t=e.data;t.hand&&!this.motionController&&(this.xrInputSource=t,this.motionController=new a(this,this.controller,void 0,t.handedness,"left"===t.handedness?this.leftModelPath:this.rightModelPath))},this._onDisconnected=()=>{var e;(null==(e=this.xrInputSource)?void 0:e.hand)&&this.motionControllerCleanup()},this.controller=e,this.motionController=null,this.envMap=null,this.leftModelPath=t,this.rightModelPath=n,this.mesh=null,this.xrInputSource=null,e.addEventListener("connected",this._onConnected),e.addEventListener("disconnected",this._onDisconnected)}motionControllerCleanup(){var e;this.clear(),null==(e=this.motionController)||e.dispose(),this.motionController=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){let e=this.controller.joints["index-finger-tip"];return e?e.position:null}intersectBoxObject(e){let t=this.getPointerPosition();if(!t)return!1;{let n=new i.aLr(t,.01),r=new i.ZzF().setFromObject(e);return n.intersectsBox(r)}}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}dispose(){this.motionControllerCleanup(),this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var u=n(60701),c=n(20898);function h({modelLeft:e,modelRight:t}){let n=(0,u.nH)(e=>e.controllers);return r.useMemo(()=>(0,s.e)({OculusHandModel:l}),[]),(0,c.LI)(()=>{for(let e of n)e.hand.dispatchEvent({type:"connected",data:e.inputSource,fake:!0})},[n,e,t]),r.createElement(r.Fragment,null,n.map(({hand:n})=>(0,s.h)(r.createElement("oculusHandModel",{args:[n,e,t]}),n)))}},480:function(e,t,n){"use strict";n.d(t,{bx:function(){return c},hw:function(){return p}});var r=n(67294),s=n(74250),i=n(15319),o=n(60701),a=n(20898);function l(e,t,{handedness:n}={}){let r=(0,a.W6)(t),s=(0,o.nH)(e=>e.controllers);(0,a.LI)(()=>{let t=s.map(t=>{if(n&&t.inputSource&&t.inputSource.handedness!==n)return;let s=e=>r.current({nativeEvent:e,target:t});return t.controller.addEventListener(e,s),()=>t.controller.removeEventListener(e,s)});return()=>t.forEach(e=>null==e?void 0:e())},[s,n,e])}let u=new s.yGw;function c({children:e}){let t=(0,i.D)(e=>e.events),n=(0,i.D)(e=>e.get),s=(0,i.D)(e=>e.raycaster),a=(0,o.nH)(e=>e.controllers),c=(0,o.nH)(e=>e.interactions),h=(0,o.nH)(e=>e.hoverState),d=(0,o.nH)(e=>e.hasInteraction),p=(0,o.nH)(e=>e.getInteraction),m=r.useCallback(e=>{let t=Array.from(c.keys());return u.identity().extractRotation(e.matrixWorld),s.ray.origin.setFromMatrixPosition(e.matrixWorld),s.ray.direction.set(0,0,-1).applyMatrix4(u),s.intersectObjects(t,!0)},[c,s]);(0,i.F)(()=>{var e;if(0!==c.size)for(let r of a){if(!(null==(e=r.inputSource)?void 0:e.handedness))return;let s=h[r.inputSource.handedness],i=new Set,o=m(r.controller);if(t.filter)o=t.filter(o,n());else{let e=o.find(e=>null==e?void 0:e.object);e&&(o=[e])}for(let e of o){let t=e.object;for(;t;){if(d(t,"onHover")&&!s.has(t)){let n=p(t,"onHover");for(let t of n)t({target:r,intersection:e,intersections:o})}let n=p(t,"onMove");null==n||n.forEach(t=>t({target:r,intersection:e,intersections:o})),s.set(t,e),i.add(t.id),t=t.parent}}for(let e of s.keys())if(!i.has(e.id)){s.delete(e);let t=p(e,"onBlur");if(!t)continue;for(let e of t)e({target:r,intersections:o})}}});let f=r.useCallback(e=>t=>{var n;if(!(null==(n=t.target.inputSource)?void 0:n.handedness))return;let r=h[t.target.inputSource.handedness],s=Array.from(new Set(r.values()));c.forEach((n,i)=>{var o,a,l;if(r.has(i)){if(!n[e])return;for(let a of n[e])null==(o=a.current)||o.call(a,{target:t.target,intersection:r.get(i),intersections:s})}else if("onSelect"===e&&n.onSelectMissed)for(let e of n.onSelectMissed)null==(a=e.current)||a.call(e,{target:t.target,intersections:s});else if("onSqueeze"===e&&n.onSqueezeMissed)for(let e of n.onSqueezeMissed)null==(l=e.current)||l.call(e,{target:t.target,intersections:s})})},[h,c]);return l("select",f("onSelect")),l("selectstart",f("onSelectStart")),l("selectend",f("onSelectEnd")),l("squeeze",f("onSqueeze")),l("squeezeend",f("onSqueezeEnd")),l("squeezestart",f("onSqueezeStart")),r.createElement(r.Fragment,null,e)}function h(e,t,n){let r=(0,o.nH)(e=>e.addInteraction),s=(0,o.nH)(e=>e.removeInteraction),i=(0,a.W6)(n);(0,a.LI)(()=>{let n=e.current;if(n&&i.current)return r(n,t,i),()=>s(n,t,i)},[e,t,r,s])}let d=r.forwardRef(function({onHover:e,onBlur:t,onSelectStart:n,onSelectEnd:s,onSelectMissed:i,onSelect:o,onSqueezeStart:a,onSqueezeEnd:l,onSqueezeMissed:u,onSqueeze:c,onMove:d,children:p},m){let f=r.useRef(null);return r.useImperativeHandle(m,()=>f.current),h(f,"onHover",e),h(f,"onBlur",t),h(f,"onSelectStart",n),h(f,"onSelectEnd",s),h(f,"onSelectMissed",i),h(f,"onSelect",o),h(f,"onSqueezeStart",a),h(f,"onSqueezeEnd",l),h(f,"onSqueezeMissed",u),h(f,"onSqueeze",c),h(f,"onMove",d),r.createElement("group",{ref:f},p)});function p(e){let t=(0,o.nH)(e=>e.session),n=r.useRef(),l=r.useMemo(()=>new s.yGw,[]);(0,a.LI)(()=>{if(!t)return void(n.current=void 0);t.requestReferenceSpace("viewer").then(async e=>{var r;n.current=await (null==(r=null==t?void 0:t.requestHitTestSource)?void 0:r.call(t,{space:e}))})},[t]),(0,i.F)((t,r,s)=>{if(!s||!n.current)return;let[i]=s.getHitTestResults(n.current);if(i){let n=t.gl.xr.getReferenceSpace(),r=i.getPose(n);r&&(l.fromArray(r.transform.matrix),e(l,i))}})}r.forwardRef(function({onSelectStart:e,onSelectEnd:t,children:n,...o},a){let l=r.useRef(),u=r.useRef(null),c=r.useMemo(()=>new s.yGw,[]);return r.useImperativeHandle(a,()=>u.current),(0,i.F)(()=>{let e=l.current,t=u.current;e&&(t.applyMatrix4(c),t.applyMatrix4(e.matrixWorld),t.updateMatrixWorld(),c.copy(e.matrixWorld).invert())}),r.createElement(d,{ref:u,onSelectStart:t=>{l.current=t.target.controller,c.copy(t.target.controller.matrixWorld).invert(),null==e||e(t)},onSelectEnd:e=>{e.target.controller===l.current&&(l.current=void 0),null==t||t(e)},...o},n)})},60701:function(e,t,n){"use strict";n.d(t,{_A:function(){return R},XR:function(){return f},nH:function(){return S}});var r=n(67294),s=n(74250);let i="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),o=i?r.useEffect:r.useLayoutEffect;function a(e){let t="function"==typeof e?function(e){let t;let n=new Set,r=(e,r)=>{let s="function"==typeof e?e(t):e;if(s!==t){let e=t;t=r?s:Object.assign({},t,s),n.forEach(n=>n(t,e))}},s=()=>t,i=(e,r=s,i=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let o=r(t);function a(){let n=r(t);if(!i(o,n)){let t=o;e(o=n,t)}}return n.add(a),()=>n.delete(a)},o=(e,t,r)=>t||r?i(e,t,r):(n.add(e),()=>n.delete(e)),a=()=>n.clear(),l={setState:r,getState:s,subscribe:o,destroy:a};return t=e(r,s,l),l}(e):e,n=(e=t.getState,n=Object.is)=>{let s;let[,i]=(0,r.useReducer)(e=>e+1,0),a=t.getState(),l=(0,r.useRef)(a),u=(0,r.useRef)(e),c=(0,r.useRef)(n),h=(0,r.useRef)(!1),d=(0,r.useRef)();void 0===d.current&&(d.current=e(a));let p=!1;(l.current!==a||u.current!==e||c.current!==n||h.current)&&(s=e(a),p=!n(d.current,s)),o(()=>{p&&(d.current=s),l.current=a,u.current=e,c.current=n,h.current=!1});let m=(0,r.useRef)(a);o(()=>{let e=()=>{try{let e=t.getState(),n=u.current(e);c.current(d.current,n)||(l.current=e,d.current=n,i())}catch(e){h.current=!0,i()}},n=t.subscribe(e);return t.getState()!==m.current&&e(),n},[]);let f=p?s:d.current;return(0,r.useDebugValue)(f),f};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");let e=[n,t];return{next(){let t=e.length<=0;return{value:e.shift(),done:t}}}},n}var l=n(15319);class u extends s.ZAu{constructor(e,t){super(),this.inputSource=null,this.xrControllerModel=null,this.index=e,this.controller=t.xr.getController(e),this.grip=t.xr.getControllerGrip(e),this.hand=t.xr.getHand(e),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){!e.fake&&e.data&&(this.visible=!0,this.inputSource=e.data,this.dispatchEvent(e))}_onDisconnected(e){e.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(e))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var c=n(480),h=n(20898);let d=r.createContext(null),p=a((e,t)=>({set:e,get:t,session:null,referenceSpaceType:null}));function m({foveation:e=0,frameRate:t,referenceSpace:n="local-floor",onSessionStart:s,onSessionEnd:i,onVisibilityChange:o,onInputSourcesChange:a,children:d}){let m=(0,l.D)(e=>e.gl),f=(0,l.D)(e=>e.camera),g=S(e=>e.player),v=S(e=>e.get),A=S(e=>e.set),x=S(e=>e.session),T=S(e=>e.controllers),E=(0,h.W6)(s),y=(0,h.W6)(i),R=(0,h.W6)(o),w=(0,h.W6)(a);return(0,h.LI)(()=>{let e=[0,1].map(e=>{let t=new u(e,m),n=()=>A(e=>({controllers:[...e.controllers,t]})),r=()=>A(e=>({controllers:e.controllers.filter(e=>e!==t)}));return t.addEventListener("connected",n),t.addEventListener("disconnected",r),()=>{t.removeEventListener("connected",n),t.removeEventListener("disconnected",r)}});return()=>e.forEach(e=>e())},[m,A]),(0,h.LI)(()=>p.subscribe(({session:e})=>A(()=>({session:e}))),[m.xr,A]),(0,h.LI)(()=>{m.xr.setFoveation(e),A(()=>({foveation:e}))},[m.xr,e,A]),(0,h.LI)(()=>{var e;try{t&&(null==(e=null==x?void 0:x.updateTargetFrameRate)||e.call(x,t))}catch(e){}A(()=>({frameRate:t}))},[x,t,A]),(0,h.LI)(()=>{let e=p.getState();m.xr.setReferenceSpaceType(n),A(()=>({referenceSpace:n})),e.set({referenceSpaceType:n})},[m.xr,n,A]),(0,h.LI)(()=>{if(!x)return void m.xr.setSession(null);let e=e=>{var t;A(()=>({isPresenting:!0})),null==(t=E.current)||t.call(E,{nativeEvent:{...e,target:x},target:x})},t=e=>{var t;A(()=>({isPresenting:!1,session:null})),p.setState(()=>({session:null})),null==(t=y.current)||t.call(y,{nativeEvent:{...e,target:x},target:x})},n=e=>{var t;null==(t=R.current)||t.call(R,{nativeEvent:e,target:x})},r=e=>{var t;let n=Object.values(x.inputSources).some(e=>e.hand);A(()=>({isHandTracking:n})),null==(t=w.current)||t.call(w,{nativeEvent:e,target:x})};return m.xr.addEventListener("sessionstart",e),m.xr.addEventListener("sessionend",t),x.addEventListener("visibilitychange",n),x.addEventListener("inputsourceschange",r),m.xr.setSession(x).then(()=>{m.xr.setFoveation(v().foveation)}),()=>{m.xr.removeEventListener("sessionstart",e),m.xr.removeEventListener("sessionend",t),x.removeEventListener("visibilitychange",n),x.removeEventListener("inputsourceschange",r)}},[x,m.xr,A,v]),r.createElement(c.bx,null,r.createElement("primitive",{object:g},r.createElement("primitive",{object:f}),T.map(e=>r.createElement("primitive",{key:e.index,object:e}))),d)}function f(e){let t=r.useMemo(()=>a((e,t)=>({set:e,get:t,controllers:[],isPresenting:!1,isHandTracking:!1,player:new s.ZAu,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(e,n){var r;return!!(null==(r=t().interactions.get(e))?void 0:r[n].some(e=>e.current))},getInteraction(e,n){var r;return null==(r=t().interactions.get(e))?void 0:r[n].reduce((e,t)=>(t.current&&e.push(t.current),e),[])},addInteraction(e,n,r){let s=t().interactions;s.has(e)||s.set(e,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]});let i=s.get(e);i[n].push(r)},removeInteraction(e,n,r){let s=t().interactions.get(e);if(s){let e=s[n].indexOf(r);-1!==e&&s[n].splice(e,1)}}})),[]);return r.createElement(d.Provider,{value:t},r.createElement(m,{...e}))}let g=(e,t)=>{var n;return e||t?e&&!t?{optionalFeatures:[e]}:e&&t?{...t,optionalFeatures:(0,h.jj)([...null!=(n=t.optionalFeatures)?n:[],e])}:t:void 0},v=async(e,t)=>{let n=p.getState();if(n.session){console.warn("@react-three/xr: session already started, please stop it first");return}let r=g(n.referenceSpaceType,t),s=await navigator.xr.requestSession(e,r);return n.set(()=>({session:s})),s},A=async()=>{let e=p.getState();if(!e.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await e.session.end(),e.set({session:null})},x=async(e,{sessionInit:t,enterOnly:n,exitOnly:r}={})=>{let s=p.getState();if((!s.session||!n)&&(s.session||!r))return s.session?await A():await v(e,t)},T=(e,t,n)=>{switch(e){case"entered":return`Exit ${t}`;case"exited":return`Enter ${t}`;default:switch(n){case"https":return"HTTPS needed";case"security":return`${t} blocked`;default:return`${t} unsupported`}}},E=r.forwardRef(function({mode:e,sessionInit:t,enterOnly:n=!1,exitOnly:s=!1,onClick:i,onError:o,children:a,...l},u){var c;let[d,m]=r.useState("exited"),[f,g]=r.useState("unknown"),v=T(d,e,f),A="inline"===e?e:`immersive-${e.toLowerCase()}`,E=(0,h.W6)(o);(0,h.LI)(()=>{if(!(null==navigator?void 0:navigator.xr))return void m("unsupported");navigator.xr.isSessionSupported(A).then(e=>{if(e)m("exited");else{let e="https:"===location.protocol;m("unsupported"),g(e?"unknown":"https")}}).catch(e=>{m("unsupported"),"name"in e&&"SecurityError"===e.name?g("security"):g("unknown")})},[A]),(0,h.LI)(()=>p.subscribe(e=>{e.session?m("entered"):"unsupported"!==d&&m("exited")}),[d]);let y=r.useCallback(async e=>{null==i||i(e);try{x(A,{sessionInit:t,enterOnly:n,exitOnly:s})}catch(t){let e=E.current;if(e&&t instanceof Error)e(t);else throw t}},[i,A,t,n,s,E]);return r.createElement("button",{...l,ref:u,onClick:"unsupported"===d?i:y},null!=(c="function"==typeof a?a(d):a)?c:v)}),y={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"},R=r.forwardRef(({style:e=y,sessionInit:t={domOverlay:"undefined"!=typeof document?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:n,...s},i)=>r.createElement(E,{...s,ref:i,mode:"AR",style:e,sessionInit:t},n));function S(e=e=>e,t){let n=r.useContext(d);if(!n)throw Error("useXR must be used within an <XR /> component!");return n(e,t)}r.forwardRef(({style:e=y,sessionInit:t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:n,...s},i)=>r.createElement(E,{...s,ref:i,mode:"VR",style:e,sessionInit:t},n))},20898:function(e,t,n){"use strict";n.d(t,{LI:function(){return a},W6:function(){return l},jj:function(){return o}});var r,s,i=n(67294);let o=e=>Array.from(new Set(e)),a="undefined"!=typeof window&&((null==(r=window.document)?void 0:r.createElement)||(null==(s=window.navigator)?void 0:s.product)==="ReactNative")?i.useLayoutEffect:i.useEffect;function l(e){let t=i.useRef(e);return a(()=>void(t.current=e),[e]),t}},24591:function(e,t,n){"use strict";n.d(t,{E:function(){return u}});var r=n(74250);function s(e,t){if(t===r.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==r.z$h&&t!==r.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let n=e.getIndex();if(null===n){let t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}let s=n.count-2,i=[];if(n){if(t===r.z$h)for(let e=1;e<=s;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)))}i.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=e.clone();return o.setIndex(i),o.clearGroups(),o}}let i=parseInt(r.UZH.replace(/\D+/g,""));function o(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}let a="srgb",l="srgb-linear";class u extends r.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new f(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new w(e)}),this.register(function(e){return new b(e)}),this.register(function(e){return new _(e)}),this.register(function(e){return new A(e)}),this.register(function(e){return new x(e)}),this.register(function(e){return new T(e)}),this.register(function(e){return new E(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new y(e)}),this.register(function(e){return new v(e)}),this.register(function(e){return new S(e)}),this.register(function(e){return new R(e)}),this.register(function(e){return new d(e)}),this.register(function(e){return new I(e)}),this.register(function(e){return new M(e)})}load(e,t,n,s){let i;let o=this;if(""!==this.resourcePath)i=this.resourcePath;else if(""!==this.path){let t=r.Zp0.extractUrlBase(e);i=r.Zp0.resolveURL(t,this.path)}else i=r.Zp0.extractUrlBase(e);this.manager.itemStart(e);let a=function(t){s?s(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(n){try{o.parse(n,i,function(n){t(n),o.manager.itemEnd(e)},a)}catch(e){a(e)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;let i={},a={};if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){let t=o(new Uint8Array(e.slice(0,4)));if(t===L){try{i[h.KHR_BINARY_GLTF]=new C(e)}catch(e){r&&r(e);return}s=JSON.parse(i[h.KHR_BINARY_GLTF].content)}else s=JSON.parse(o(new Uint8Array(e)))}else s=e;if(void 0===s.asset||s.asset.version[0]<2){r&&r(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let l=new Q(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[t.name]=t,i[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){let t=s.extensionsUsed[e],n=s.extensionsRequired||[];switch(t){case h.KHR_MATERIALS_UNLIT:i[t]=new p;break;case h.KHR_DRACO_MESH_COMPRESSION:i[t]=new P(s,this.dracoLoader);break;case h.KHR_TEXTURE_TRANSFORM:i[t]=new O;break;case h.KHR_MESH_QUANTIZATION:i[t]=new H;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(i),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){let n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function c(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class d{constructor(e){this.parser=e,this.name=h.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){let r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t;let n=this.parser,s="light:"+e,i=n.cache.get(s);if(i)return i;let o=n.json,a=o.extensions&&o.extensions[this.name]||{},u=a.lights||[],c=u[e],h=new r.Ilk(16777215);void 0!==c.color&&h.setRGB(c.color[0],c.color[1],c.color[2],l);let d=void 0!==c.range?c.range:0;switch(c.type){case"directional":(t=new r.Ox3(h)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new r.cek(h)).distance=d;break;case"spot":(t=new r.PMe(h)).distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,t.angle=c.spot.outerConeAngle,t.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return t.position.set(0,0,0),t.decay=2,$(t,c),void 0!==c.intensity&&(t.intensity=c.intensity),t.name=n.createUniqueName(c.name||"light_"+e),i=Promise.resolve(t),n.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,n=this.parser,r=n.json,s=r.nodes[e],i=s.extensions&&s.extensions[this.name]||{},o=i.light;return void 0===o?null:this._loadLight(o).then(function(e){return n._getNodeRef(t.cache,o,e)})}}class p{constructor(){this.name=h.KHR_MATERIALS_UNLIT}getMaterialType(){return r.vBJ}extendParams(e,t,n){let s=[];e.color=new r.Ilk(1,1,1),e.opacity=1;let i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],l),e.opacity=t[3]}void 0!==i.baseColorTexture&&s.push(n.assignTexture(e,"map",i.baseColorTexture,a))}return Promise.all(s)}}class m{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let i=[],o=s.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){let e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.FM8(e,e)}return Promise.all(i)}}class g{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=r.extensions[this.name];return t.dispersion=void 0!==s.dispersion?s.dispersion:0,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],i=r.extensions[this.name];return void 0!==i.iridescenceFactor&&(t.iridescence=i.iridescenceFactor),void 0!==i.iridescenceTexture&&s.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),void 0!==i.iridescenceIor&&(t.iridescenceIOR=i.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==i.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),void 0!==i.iridescenceThicknessTexture&&s.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(s)}}class A{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let i=[];t.sheenColor=new r.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;let o=s.extensions[this.name];if(void 0!==o.sheenColorFactor){let e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],l)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,a)),void 0!==o.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class x{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&s.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(s)}}class T{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let i=[],o=s.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;let a=o.attenuationColor||[1,1,1];return t.attenuationColor=new r.Ilk().setRGB(a[0],a[1],a[2],l),Promise.all(i)}}class E{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=r.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class y{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let i=[],o=s.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));let u=o.specularColorFactor||[1,1,1];return t.specularColor=new r.Ilk().setRGB(u[0],u[1],u[2],l),void 0!==o.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,a)),Promise.all(i)}}class R{constructor(e){this.parser=e,this.name=h.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],i=r.extensions[this.name];return t.bumpScale=void 0!==i.bumpFactor?i.bumpFactor:1,void 0!==i.bumpTexture&&s.push(n.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(s)}}class S{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser,n=t.json.materials[e];return n.extensions&&n.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],i=r.extensions[this.name];return void 0!==i.anisotropyStrength&&(t.anisotropy=i.anisotropyStrength),void 0!==i.anisotropyRotation&&(t.anisotropyRotation=i.anisotropyRotation),void 0!==i.anisotropyTexture&&s.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(s)}}class w{constructor(e){this.parser=e,this.name=h.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let s=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(!(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,s.source,i)}}class b{constructor(e){this.parser=e,this.name=h.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;let i=s.extensions[t],o=r.images[i.source],a=n.textureLoader;if(o.uri){let e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,i.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class _{constructor(e){this.parser=e,this.name=h.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;let i=s.extensions[t],o=r.images[i.source],a=n.textureLoader;if(o.uri){let e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,i.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class I{constructor(e){this.name=h.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,n=t.bufferViews[e];if(!n.extensions||!n.extensions[this.name])return null;{let e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return r.then(function(t){let n=e.byteOffset||0,r=e.byteLength||0,i=e.count,o=e.byteStride,a=new Uint8Array(t,n,r);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(i,o,a,e.mode,e.filter).then(function(e){return e.buffer}):s.ready.then(function(){let t=new ArrayBuffer(i*o);return s.decodeGltfBuffer(new Uint8Array(t),i,o,a,e.mode,e.filter),t})})}}}class M{constructor(e){this.name=h.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;let s=t.meshes[n.mesh];for(let e of s.primitives)if(e.mode!==U.TRIANGLES&&e.mode!==U.TRIANGLE_STRIP&&e.mode!==U.TRIANGLE_FAN&&void 0!==e.mode)return null;let i=n.extensions[this.name],o=i.attributes,a=[],l={};for(let e in o)a.push(this.parser.getDependency("accessor",o[e]).then(t=>(l[e]=t,l[e])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{let t=e.pop(),n=t.isGroup?t.children:[t],s=e[0].count,i=[];for(let e of n){let t=new r.yGw,n=new r.Pa4,o=new r._fP,a=new r.Pa4(1,1,1),u=new r.SPe(e.geometry,e.material,s);for(let e=0;e<s;e++)l.TRANSLATION&&n.fromBufferAttribute(l.TRANSLATION,e),l.ROTATION&&o.fromBufferAttribute(l.ROTATION,e),l.SCALE&&a.fromBufferAttribute(l.SCALE,e),u.setMatrixAt(e,t.compose(n,o,a));for(let t in l)if("_COLOR_0"===t){let e=l[t];u.instanceColor=new r.lb7(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,l[t]);r.Tme.prototype.copy.call(u,e),this.parser.assignFinalMaterial(u),i.push(u)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]}))}}let L="glTF",N={JSON:1313821514,BIN:5130562};class C{constructor(e){this.name=h.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:o(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==L)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-12,r=new DataView(e,12),s=0;for(;s<n;){let t=r.getUint32(s,!0);s+=4;let n=r.getUint32(s,!0);if(s+=4,n===N.JSON){let n=new Uint8Array(e,12+s,t);this.content=o(n)}else if(n===N.BIN){let n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class P{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=h.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},a={},u={};for(let e in i){let t=X[e]||e.toLowerCase();o[t]=i[e]}for(let t in e.attributes){let r=X[t]||t.toLowerCase();if(void 0!==i[t]){let s=n.accessors[e.attributes[t]],i=j[s.componentType];u[r]=i.name,a[r]=!0===s.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t,n){r.decodeDracoFile(e,function(e){for(let t in e.attributes){let n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)},o,u,l,n)})})}}class O{constructor(){this.name=h.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class H{constructor(){this.name=h.KHR_MESH_QUANTIZATION}}class k extends r._C8{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[s+e];return t}interpolate_(e,t,n,r){let s=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,u=r-t,c=(n-t)/u,h=c*c,d=h*c,p=e*l,m=p-l,f=-2*d+3*h,g=d-h,v=1-f,A=g-h+c;for(let e=0;e!==o;e++){let t=i[m+e+o],n=i[m+e+a]*u,r=i[p+e+o],l=i[p+e]*u;s[e]=v*t+A*n+f*r+g*l}return s}}let F=new r._fP;class D extends k{interpolate_(e,t,n,r){let s=super.interpolate_(e,t,n,r);return F.fromArray(s).normalize().toArray(s),s}}let U={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},j={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},B={9728:r.TyD,9729:r.wem,9984:r.YLQ,9985:r.qyh,9986:r.aH4,9987:r.D1R},G={33071:r.uWy,33648:r.OoA,10497:r.rpg},K={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},X={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...i>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},V={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},z={CUBICSPLINE:void 0,LINEAR:r.NMF,STEP:r.Syv},q={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function W(e,t,n){for(let r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function $(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Z(e){let t="",n=Object.keys(e).sort();for(let r=0,s=n.length;r<s;r++)t+=n[r]+":"+e[n[r]]+";";return t}function J(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let Y=new r.yGw;class Q{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new c,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,i=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=(s=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||s&&i<98?this.textureLoader=new r.dpR(this.options.manager):this.textureLoader=new r.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){let i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return W(s,i,r),$(i,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(i)})).then(function(){for(let e of i.scenes)e.updateMatrixWorld();e(i)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){let r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){let r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;let r=n.clone(),s=(e,t)=>{let n=this.associations.get(e);for(let[r,i]of(null!=n&&this.associations.set(t,n),e.children.entries()))s(i,t.children[r])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){let r=e(t[n]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let n=[];for(let r=0;r<t.length;r++){let s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){let n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(!(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body);let s=this.options;return new Promise(function(e,i){n.load(r.Zp0.resolveURL(t.uri,s.path),e,void 0,function(){i(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){let t=this,n=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse){let e=K[s.type],t=j[s.componentType],n=!0===s.normalized,i=new t(s.count*e);return Promise.resolve(new r.TlE(i,e,n))}let i=[];return void 0!==s.bufferView?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),void 0!==s.sparse&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(e){let i,o;let a=e[0],l=K[s.type],u=j[s.componentType],c=u.BYTES_PER_ELEMENT,h=s.byteOffset||0,d=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,p=!0===s.normalized;if(d&&d!==c*l){let e=Math.floor(h/d),n="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count,m=t.cache.get(n);m||(i=new u(a,e*d,s.count*d/c),m=new r.vpT(i,d/c),t.cache.add(n,m)),o=new r.kB5(m,l,h%d/c,p)}else i=null===a?new u(s.count*l):new u(a,h,s.count*l),o=new r.TlE(i,l,p);if(void 0!==s.sparse){let t=K.SCALAR,n=j[s.sparse.indices.componentType],i=s.sparse.indices.byteOffset||0,c=s.sparse.values.byteOffset||0,h=new n(e[1],i,s.sparse.count*t),d=new u(e[2],c,s.sparse.count*l);null!==a&&(o=new r.TlE(o.array.slice(),o.itemSize,o.normalized));for(let e=0,t=h.length;e<t;e++){let t=h[e];if(o.setX(t,d[e*l]),l>=2&&o.setY(t,d[e*l+1]),l>=3&&o.setZ(t,d[e*l+2]),l>=4&&o.setW(t,d[e*l+3]),l>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})}loadTexture(e){let t=this.json,n=this.options,r=t.textures[e],s=r.source,i=t.images[s],o=this.textureLoader;if(i.uri){let e=n.manager.getHandler(i.uri);null!==e&&(o=e)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,n){let s=this,i=this.json,o=i.textures[e],a=i.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];let u=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=o.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);let n=i.samplers||{},l=n[o.sampler]||{};return t.magFilter=B[l.magFilter]||r.wem,t.minFilter=B[l.minFilter]||r.D1R,t.wrapS=G[l.wrapS]||r.rpg,t.wrapT=G[l.wrapT]||r.rpg,s.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){let n=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let i=n.images[e],o=self.URL||self.webkitURL,a=i.uri||"",l=!1;if(void 0!==i.bufferView)a=this.getDependency("bufferView",i.bufferView).then(function(e){l=!0;let t=new Blob([e],{type:i.mimeType});return a=o.createObjectURL(t)});else if(void 0===i.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let u=Promise.resolve(a).then(function(e){return new Promise(function(n,i){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){let t=new r.xEZ(e);t.needsUpdate=!0,n(t)}),t.load(r.Zp0.resolveURL(e,s.path),o,void 0,i)})}).then(function(e){var t;return!0===l&&o.revokeObjectURL(a),$(e,i),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){let s=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((i=i.clone()).channel=n.texCoord),s.extensions[h.KHR_TEXTURE_TRANSFORM]){let e=void 0!==n.extensions?n.extensions[h.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=s.associations.get(i);i=s.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),s.associations.set(i,t)}}return void 0!==r&&("number"==typeof r&&(r=3001===r?a:l),"colorSpace"in i?i.colorSpace=r:i.encoding=r===a?3001:3e3),e[t]=i,i})}assignFinalMaterial(e){let t=e.geometry,n=e.material,s=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+n.uuid,t=this.cache.get(e);t||(t=new r.UY4,r.F5T.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){let e="LineBasicMaterial:"+n.uuid,t=this.cache.get(e);t||(t=new r.nls,r.F5T.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(s||i||o){let e="ClonedMaterial:"+n.uuid+":";s&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),o&&(t.flatShading=!0),s&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return r.Wid}loadMaterial(e){let t;let n=this,s=this.json,i=this.extensions,o=s.materials[e],u={},c=o.extensions||{},d=[];if(c[h.KHR_MATERIALS_UNLIT]){let e=i[h.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),d.push(e.extendParams(u,o,n))}else{let s=o.pbrMetallicRoughness||{};if(u.color=new r.Ilk(1,1,1),u.opacity=1,Array.isArray(s.baseColorFactor)){let e=s.baseColorFactor;u.color.setRGB(e[0],e[1],e[2],l),u.opacity=e[3]}void 0!==s.baseColorTexture&&d.push(n.assignTexture(u,"map",s.baseColorTexture,a)),u.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,u.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(d.push(n.assignTexture(u,"metalnessMap",s.metallicRoughnessTexture)),d.push(n.assignTexture(u,"roughnessMap",s.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,u)})))}!0===o.doubleSided&&(u.side=r.ehD);let p=o.alphaMode||q.OPAQUE;if(p===q.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,p===q.MASK&&(u.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==r.vBJ&&(d.push(n.assignTexture(u,"normalMap",o.normalTexture)),u.normalScale=new r.FM8(1,1),void 0!==o.normalTexture.scale)){let e=o.normalTexture.scale;u.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&t!==r.vBJ&&(d.push(n.assignTexture(u,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(u.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==r.vBJ){let e=o.emissiveFactor;u.emissive=new r.Ilk().setRGB(e[0],e[1],e[2],l)}return void 0!==o.emissiveTexture&&t!==r.vBJ&&d.push(n.assignTexture(u,"emissiveMap",o.emissiveTexture,a)),Promise.all(d).then(function(){let r=new t(u);return o.name&&(r.name=o.name),$(r,o),n.associations.set(r,{materials:e}),o.extensions&&W(i,r,o),r})}createUniqueName(e){let t=r.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,n=this.extensions,s=this.primitiveCache,i=[];for(let o=0,a=e.length;o<a;o++){let a=e[o],l=function(e){let t;let n=e.extensions&&e.extensions[h.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Z(n.attributes):e.indices+":"+Z(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,r=e.targets.length;n<r;n++)t+=":"+Z(e.targets[n]);return t}(a),u=s[l];if(u)i.push(u.promise);else{let e;e=a.extensions&&a.extensions[h.KHR_DRACO_MESH_COMPRESSION]?function(e){return n[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return ee(n,e,t)})}(a):ee(new r.u9r,a,t),s[l]={primitive:a,promise:e},i.push(e)}}return Promise.all(i)}loadMesh(e){let t=this,n=this.json,i=this.extensions,o=n.meshes[e],a=o.primitives,l=[];for(let e=0,t=a.length;e<t;e++){var u;let t=void 0===a[e].material?(void 0===(u=this.cache).DefaultMaterial&&(u.DefaultMaterial=new r.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.Wl3})),u.DefaultMaterial):this.getDependency("material",a[e].material);l.push(t)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(n){let l=n.slice(0,n.length-1),u=n[n.length-1],c=[];for(let n=0,h=u.length;n<h;n++){let h;let d=u[n],p=a[n],m=l[n];if(p.mode===U.TRIANGLES||p.mode===U.TRIANGLE_STRIP||p.mode===U.TRIANGLE_FAN||void 0===p.mode)!0===(h=!0===o.isSkinnedMesh?new r.TUv(d,m):new r.Kj0(d,m)).isSkinnedMesh&&h.normalizeSkinWeights(),p.mode===U.TRIANGLE_STRIP?h.geometry=s(h.geometry,r.UlW):p.mode===U.TRIANGLE_FAN&&(h.geometry=s(h.geometry,r.z$h));else if(p.mode===U.LINES)h=new r.ejS(d,m);else if(p.mode===U.LINE_STRIP)h=new r.x12(d,m);else if(p.mode===U.LINE_LOOP)h=new r.blk(d,m);else if(p.mode===U.POINTS)h=new r.woe(d,m);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(h.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){let n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(h,o),h.name=t.createUniqueName(o.name||"mesh_"+e),$(h,o),p.extensions&&W(i,h,p),t.assignFinalMaterial(h),c.push(h)}for(let n=0,r=c.length;n<r;n++)t.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return o.extensions&&W(i,c[0],o),c[0];let h=new r.ZAu;o.extensions&&W(i,h,o),t.associations.set(h,{meshes:e});for(let e=0,t=c.length;e<t;e++)h.add(c[e]);return h})}loadCamera(e){let t;let n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===n.type?t=new r.cPb(r.M8C.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(t=new r.iKG(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),$(t,n),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){let n=e.pop(),s=[],i=[];for(let o=0,a=e.length;o<a;o++){let a=e[o];if(a){s.push(a);let e=new r.yGw;null!==n&&e.fromArray(n.array,16*o),i.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new r.OdW(s,i)})}loadAnimation(e){let t=this.json,n=this,s=t.animations[e],i=s.name?s.name:"animation_"+e,o=[],a=[],l=[],u=[],c=[];for(let e=0,t=s.channels.length;e<t;e++){let t=s.channels[e],n=s.samplers[t.sampler],r=t.target,i=r.node,h=void 0!==s.parameters?s.parameters[n.input]:n.input,d=void 0!==s.parameters?s.parameters[n.output]:n.output;void 0!==r.node&&(o.push(this.getDependency("node",i)),a.push(this.getDependency("accessor",h)),l.push(this.getDependency("accessor",d)),u.push(n),c.push(r))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(u),Promise.all(c)]).then(function(e){let t=e[0],s=e[1],o=e[2],a=e[3],l=e[4],u=[];for(let e=0,r=t.length;e<r;e++){let r=t[e],i=s[e],c=o[e],h=a[e],d=l[e];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();let p=n._createAnimationTracks(r,i,c,h,d);if(p)for(let e=0;e<p.length;e++)u.push(p[e])}return new r.m7l(i,void 0,u)})}createNodeMesh(e){let t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){let t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){let t=this.json,n=t.nodes[e],r=this._loadNodeShallow(e),s=[],i=n.children||[];for(let e=0,t=i.length;e<t;e++)s.push(this.getDependency("node",i[e]));let o=void 0===n.skin?Promise.resolve(null):this.getDependency("skin",n.skin);return Promise.all([r,Promise.all(s),o]).then(function(e){let t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,Y)});for(let e=0,r=n.length;e<r;e++)t.add(n[e]);return t})}_loadNodeShallow(e){let t=this.json,n=this.extensions,s=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let i=t.nodes[e],o=i.name?s.createUniqueName(i.name):"",a=[],l=s._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return l&&a.push(l),void 0!==i.camera&&a.push(s.getDependency("camera",i.camera).then(function(e){return s._getNodeRef(s.cameraCache,i.camera,e)})),s._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){a.push(e)}),this.nodeCache[e]=Promise.all(a).then(function(t){let a;if((a=!0===i.isBone?new r.N$j:t.length>1?new r.ZAu:1===t.length?t[0]:new r.Tme)!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(i.name&&(a.userData.name=i.name,a.name=o),$(a,i),i.extensions&&W(n,a,i),void 0!==i.matrix){let e=new r.yGw;e.fromArray(i.matrix),a.applyMatrix4(e)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return s.associations.has(a)||s.associations.set(a,{}),s.associations.get(a).nodes=e,a}),this.nodeCache[e]}loadScene(e){let t=this.extensions,n=this.json.scenes[e],s=this,i=new r.ZAu;n.name&&(i.name=s.createUniqueName(n.name)),$(i,n),n.extensions&&W(t,i,n);let o=n.nodes||[],a=[];for(let e=0,t=o.length;e<t;e++)a.push(s.getDependency("node",o[e]));return Promise.all(a).then(function(e){for(let t=0,n=e.length;t<n;t++)i.add(e[t]);return s.associations=(e=>{let t=new Map;for(let[e,n]of s.associations)(e instanceof r.F5T||e instanceof r.xEZ)&&t.set(e,n);return e.traverse(e=>{let n=s.associations.get(e);null!=n&&t.set(e,n)}),t})(i),i})}_createAnimationTracks(e,t,n,s,i){let o;let a=[],l=e.name?e.name:e.uuid,u=[];switch(V[i.path]===V.weights?e.traverse(function(e){e.morphTargetInfluences&&u.push(e.name?e.name:e.uuid)}):u.push(l),V[i.path]){case V.weights:o=r.dUE;break;case V.rotation:o=r.iLg;break;case V.position:case V.scale:o=r.yC1;break;default:o=1===n.itemSize?r.dUE:r.yC1}let c=void 0!==s.interpolation?z[s.interpolation]:r.NMF,h=this._getArrayFromAccessor(n);for(let e=0,n=u.length;e<n;e++){let n=new o(u[e]+"."+V[i.path],t.array,h,c);"CUBICSPLINE"===s.interpolation&&this._createCubicSplineTrackInterpolant(n),a.push(n)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=J(t.constructor),n=new Float32Array(t.length);for(let r=0,s=t.length;r<s;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){let t=this instanceof r.iLg?D:k;return new t(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ee(e,t,n){let s=t.attributes,i=[];for(let t in s){let r=X[t]||t.toLowerCase();r in e.attributes||i.push(function(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}(s[t],r))}if(void 0!==t.indices&&!e.index){let r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(r)}return $(e,t),!function(e,t,n){let s=t.attributes,i=new r.ZzF;if(void 0===s.POSITION)return;{let e=n.json.accessors[s.POSITION],t=e.min,o=e.max;if(void 0!==t&&void 0!==o){if(i.set(new r.Pa4(t[0],t[1],t[2]),new r.Pa4(o[0],o[1],o[2])),e.normalized){let t=J(j[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let o=t.targets;if(void 0!==o){let e=new r.Pa4,t=new r.Pa4;for(let r=0,s=o.length;r<s;r++){let s=o[r];if(void 0!==s.POSITION){let r=n.json.accessors[s.POSITION],i=r.min,o=r.max;if(void 0!==i&&void 0!==o){if(t.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),r.normalized){let e=J(j[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;let a=new r.aLr;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,s=!1,i=!1;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(s=!0),void 0!==n.COLOR_0&&(i=!0),r&&s&&i)break}if(!r&&!s&&!i)return Promise.resolve(e);let o=[],a=[],l=[];for(let u=0,c=t.length;u<c;u++){let c=t[u];if(r){let t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;o.push(t)}if(s){let t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;a.push(t)}if(i){let t=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(t){let n=t[0],o=t[1],a=t[2];return r&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=o),i&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}}}]);