(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70],{5623:function(e,t,n){"use strict";n.r(t),n.d(t,{DeviceOrientationControlsStory:function(){return g},default:function(){return E}});var i=n(9848),r=n.n(i),o=n(7294),s=n(5029),a=n(7462),c=n(3249),l=n(9477);let u=e=>"function"==typeof e,d=o.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:i,children:r,...s},d)=>{var h;let f=(0,c.z)(({set:e})=>e),v=(0,c.z)(({camera:e})=>e),m=(0,c.z)(({size:e})=>e),w=o.useRef(null),p=o.useRef(null),g=function(e,t,n){let{gl:i,size:r,viewport:s}=(0,c.z)(),a="number"==typeof e?e:r.width*s.dpr,u="number"==typeof t?t:r.height*s.dpr,{samples:d=0,depth:h,...f}=("number"==typeof e?void 0:e)||{},v=o.useMemo(()=>{let e;return e=new l.WebGLRenderTarget(a,u,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,encoding:i.outputEncoding,type:l.HalfFloatType,...f}),h&&(e.depthTexture=new l.DepthTexture(a,u,l.FloatType)),e.samples=d,e},[]);return o.useLayoutEffect(()=>{v.setSize(a,u),d&&(v.samples=d)},[d,v,a,u]),o.useEffect(()=>()=>v.dispose(),[]),v}(t);o.useLayoutEffect(()=>{s.manual||(w.current.aspect=m.width/m.height)},[m,s]),o.useLayoutEffect(()=>{w.current.updateProjectionMatrix()});let E=0,x=null,b=u(r);return(0,c.A)(t=>{b&&(n===1/0||E<n)&&(p.current.visible=!1,t.gl.setRenderTarget(g),x=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,w.current),t.scene.background=x,t.gl.setRenderTarget(null),p.current.visible=!0,E++)}),o.useLayoutEffect(()=>{if(i)return f(()=>({camera:w.current})),()=>f(()=>({camera:v}))},[w,i,f]),o.createElement(o.Fragment,null,o.createElement("perspectiveCamera",(0,a.Z)({ref:(h=[w,d],function(e){h.forEach(function(t){"function"==typeof t?t(e):null!=t&&(t.current=e)})})},s),!b&&r),o.createElement("group",{ref:p},b&&r(g.texture)))});var h=n(1180);class f extends l.EventDispatcher{constructor(e){super(),(0,h.Z)(this,"object",void 0),(0,h.Z)(this,"changeEvent",{type:"change"}),(0,h.Z)(this,"EPS",1e-6),(0,h.Z)(this,"enabled",!0),(0,h.Z)(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),(0,h.Z)(this,"screenOrientation",0),(0,h.Z)(this,"alphaOffset",0),(0,h.Z)(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),(0,h.Z)(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),(0,h.Z)(this,"zee",new l.Vector3(0,0,1)),(0,h.Z)(this,"euler",new l.Euler),(0,h.Z)(this,"q0",new l.Quaternion),(0,h.Z)(this,"q1",new l.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),(0,h.Z)(this,"setObjectQuaternion",(e,t,n,i,r)=>{this.euler.set(n,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-r))}),(0,h.Z)(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),(0,h.Z)(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),(0,h.Z)(this,"lastQuaternion",new l.Quaternion),(0,h.Z)(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?l.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,n=e.beta?l.MathUtils.degToRad(e.beta):0,i=e.gamma?l.MathUtils.degToRad(e.gamma):0,r=this.screenOrientation?l.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,n,i,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),(0,h.Z)(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let v=o.forwardRef((e,t)=>{let{camera:n,onChange:i,makeDefault:r,...s}=e,l=(0,c.z)(e=>e.camera),u=(0,c.z)(e=>e.invalidate),d=(0,c.z)(e=>e.get),h=(0,c.z)(e=>e.set),v=n||l,[m]=o.useState(()=>new f(v));return o.useEffect(()=>{let e=e=>{u(),i&&i(e)};return null==m||null==m.addEventListener||m.addEventListener("change",e),()=>null==m?void 0:null==m.removeEventListener?void 0:m.removeEventListener("change",e)},[i,m,u]),(0,c.A)(()=>null==m?void 0:m.update(),-1),o.useEffect(()=>(null==m||m.connect(),()=>null==m?void 0:m.dispose()),[m]),o.useEffect(()=>{if(r){let e=d().controls;return h({controls:m}),()=>h({controls:e})}},[r,m]),m?o.createElement("primitive",(0,a.Z)({ref:t,object:m},s)):null});function m(e){let t=e+"Geometry";return o.forwardRef(({args:e,children:n,...i},r)=>o.createElement("mesh",(0,a.Z)({ref:r},i),o.createElement(t,{attach:"geometry",args:e}),n))}let w=m("box");m("circle"),m("cone"),m("cylinder"),m("sphere"),m("plane"),m("tube"),m("torus"),m("torusKnot"),m("tetrahedron"),m("ring"),m("polyhedron"),m("icosahedron"),m("octahedron"),m("dodecahedron"),m("extrude"),m("lathe"),m("capsule");var p=n(5893);function g(){return(0,p.jsx)(p.Fragment,{})}var E=function(){var e=(0,o.useRef)(null),t=(0,o.useRef)(null),n=(0,o.useState)(!0),i=n[0],a=n[1],c=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>=0||e.indexOf("ipad")>=0||e.indexOf("ipod")>=0},l=(0,o.useState)(!1),u=(l[0],l[1]);(0,o.useEffect)(function(){new Promise(function(e,t){c()||e("resolve"),window.addEventListener("deviceorientation",function t(){window.removeEventListener("deviceorientation",t,!1),e("resolve")},!1),window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&"function"==typeof window.DeviceMotionEvent.requestPermission&&window.DeviceMotionEvent.requestPermission().then(function(e){}),window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(function(n){console.log(n),"granted"===n?(a(!1),e("resolve")):(alert(h),t("resolve"))}):(alert(h),t("resolve"))}).then(function(){u(!0)}).catch(function(e){console.log(e)})},[]);var h="モーションセンサーの使用が拒否されました。\nこのページを楽しむには、デバイスモーションセンサーの使用を許可する必要があります。\nSafariのアプリを再起動して、モーションセンサーの使用（「動作と方向」へのアクセス）を許可をしてください。";return(0,p.jsxs)("div",{className:"jsx-1483749952 page-index",children:[(0,p.jsxs)(s.Xz,{ref:e,className:"canvas",children:[(0,p.jsx)(d,{}),(0,p.jsx)(v,{ref:t}),(0,p.jsx)("ambientLight",{intensity:1,className:"jsx-1483749952"}),(0,p.jsx)("axesHelper",{args:[1],className:"jsx-1483749952"}),(0,p.jsx)(o.Suspense,{fallback:null,children:(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(w,{args:[100,100,100,4,4,4],children:[(0,p.jsx)("meshBasicMaterial",{wireframe:!0,className:"jsx-1483749952"}),(0,p.jsx)("axesHelper",{args:[100],className:"jsx-1483749952"})]})})})]}),"$",i&&(0,p.jsxs)("div",{className:"jsx-1483749952 modal",children:["このページでは端末の向きと方向を取得し ます。 次に表示されるポップアップに従って「許可」を選択してください。",(0,p.jsx)("button",{type:"button",onClick:function(){console.log("DeviceOrientationControlsRef",t.current)},className:"jsx-1483749952 btn",children:"OK"})]}),(0,p.jsx)(r(),{id:"1483749952",children:[".page-index.jsx-1483749952{width:100%;height:100%;background-color:#555;position:absolute;}",".modal.jsx-1483749952{max-width:320px;width:100%;padding:16px 32px;background:#fff;position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000;}",".modal.jsx-1483749952 .btn.jsx-1483749952{width:100%;height:40px;background:#000 !important;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:24px auto 0;text-align:center;color:#fff;font-size:1rem;cursor:pointer;}"]})]})}},8804:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webAR",function(){return n(5623)}])}},function(e){e.O(0,[737,899,774,888,179],function(){return e(e.s=8804)}),_N_E=e.O()}]);