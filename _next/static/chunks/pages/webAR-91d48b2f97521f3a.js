(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70],{5623:function(e,t,n){"use strict";n.r(t),n.d(t,{DeviceOrientationControlsStory:function(){return w},default:function(){return x}});var i=n(9848),r=n.n(i),a=n(7294),o=n(5029),s=n(7462),c=n(3249),l=n(9477);let u=e=>"function"==typeof e,d=a.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:i,children:r,...o},d)=>{var h;let f=(0,c.z)(({set:e})=>e),v=(0,c.z)(({camera:e})=>e),p=(0,c.z)(({size:e})=>e),m=a.useRef(null),g=a.useRef(null),w=function(e,t,n){let{gl:i,size:r,viewport:o}=(0,c.z)(),s="number"==typeof e?e:r.width*o.dpr,u="number"==typeof t?t:r.height*o.dpr,{samples:d=0,depth:h,...f}=("number"==typeof e?void 0:e)||{},v=a.useMemo(()=>{let e;return e=new l.WebGLRenderTarget(s,u,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,encoding:i.outputEncoding,type:l.HalfFloatType,...f}),h&&(e.depthTexture=new l.DepthTexture(s,u,l.FloatType)),e.samples=d,e},[]);return a.useLayoutEffect(()=>{v.setSize(s,u),d&&(v.samples=d)},[d,v,s,u]),a.useEffect(()=>()=>v.dispose(),[]),v}(t);a.useLayoutEffect(()=>{o.manual||(m.current.aspect=p.width/p.height)},[p,o]),a.useLayoutEffect(()=>{m.current.updateProjectionMatrix()});let x=0,E=null,b=u(r);return(0,c.A)(t=>{b&&(n===1/0||x<n)&&(g.current.visible=!1,t.gl.setRenderTarget(w),E=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,m.current),t.scene.background=E,t.gl.setRenderTarget(null),g.current.visible=!0,x++)}),a.useLayoutEffect(()=>{if(i)return f(()=>({camera:m.current})),()=>f(()=>({camera:v}))},[m,i,f]),a.createElement(a.Fragment,null,a.createElement("perspectiveCamera",(0,s.Z)({ref:(h=[m,d],function(e){h.forEach(function(t){"function"==typeof t?t(e):null!=t&&(t.current=e)})})},o),!b&&r),a.createElement("group",{ref:g},b&&r(w.texture)))});var h=n(1180);class f extends l.EventDispatcher{constructor(e){super(),(0,h.Z)(this,"object",void 0),(0,h.Z)(this,"changeEvent",{type:"change"}),(0,h.Z)(this,"EPS",1e-6),(0,h.Z)(this,"enabled",!0),(0,h.Z)(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),(0,h.Z)(this,"screenOrientation",0),(0,h.Z)(this,"alphaOffset",0),(0,h.Z)(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),(0,h.Z)(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),(0,h.Z)(this,"zee",new l.Vector3(0,0,1)),(0,h.Z)(this,"euler",new l.Euler),(0,h.Z)(this,"q0",new l.Quaternion),(0,h.Z)(this,"q1",new l.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),(0,h.Z)(this,"setObjectQuaternion",(e,t,n,i,r)=>{this.euler.set(n,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-r))}),(0,h.Z)(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),(0,h.Z)(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),(0,h.Z)(this,"lastQuaternion",new l.Quaternion),(0,h.Z)(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?l.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,n=e.beta?l.MathUtils.degToRad(e.beta):0,i=e.gamma?l.MathUtils.degToRad(e.gamma):0,r=this.screenOrientation?l.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,n,i,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),(0,h.Z)(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let v=a.forwardRef((e,t)=>{let{camera:n,onChange:i,makeDefault:r,...o}=e,l=(0,c.z)(e=>e.camera),u=(0,c.z)(e=>e.invalidate),d=(0,c.z)(e=>e.get),h=(0,c.z)(e=>e.set),v=n||l,[p]=a.useState(()=>new f(v));return a.useEffect(()=>{let e=e=>{u(),i&&i(e)};return null==p||null==p.addEventListener||p.addEventListener("change",e),()=>null==p?void 0:null==p.removeEventListener?void 0:p.removeEventListener("change",e)},[i,p,u]),(0,c.A)(()=>null==p?void 0:p.update(),-1),a.useEffect(()=>(null==p||p.connect(),()=>null==p?void 0:p.dispose()),[p]),a.useEffect(()=>{if(r){let e=d().controls;return h({controls:p}),()=>h({controls:e})}},[r,p]),p?a.createElement("primitive",(0,s.Z)({ref:t,object:p},o)):null});function p(e){let t=e+"Geometry";return a.forwardRef(({args:e,children:n,...i},r)=>a.createElement("mesh",(0,s.Z)({ref:r},i),a.createElement(t,{attach:"geometry",args:e}),n))}let m=p("box");p("circle"),p("cone"),p("cylinder"),p("sphere"),p("plane"),p("tube"),p("torus"),p("torusKnot"),p("tetrahedron"),p("ring"),p("polyhedron"),p("icosahedron"),p("octahedron"),p("dodecahedron"),p("extrude"),p("lathe"),p("capsule");var g=n(5893);function w(){return(0,g.jsx)(g.Fragment,{})}var x=function(){var e=(0,a.useRef)(null),t=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>=0||e.indexOf("ipad")>=0||e.indexOf("ipod")>=0},n=(0,a.useState)(!1),i=n[0],s=n[1];return(0,a.useEffect)(function(){new Promise(function(e,n){t()||e("resolve"),window.addEventListener("deviceorientation",function t(){window.removeEventListener("deviceorientation",t,!1),e("resolve")},!1)}).then(function(){s(!0)}).catch(function(e){console.log(e)})},[]),i?(0,g.jsxs)("div",{className:"jsx-1032130567 page-index",children:[(0,g.jsxs)(o.Xz,{ref:e,className:"canvas",children:[(0,g.jsx)(d,{}),(0,g.jsx)(v,{}),(0,g.jsx)("ambientLight",{intensity:1,className:"jsx-1032130567"}),(0,g.jsx)("axesHelper",{args:[1],className:"jsx-1032130567"}),(0,g.jsx)(a.Suspense,{fallback:null,children:(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(m,{args:[100,100,100,4,4,4],children:[(0,g.jsx)("meshBasicMaterial",{wireframe:!0,className:"jsx-1032130567"}),(0,g.jsx)("axesHelper",{args:[100],className:"jsx-1032130567"})]})})})]}),(0,g.jsxs)("div",{className:"jsx-1032130567 modal",children:["このページでは端末の向きと方向を取得し ます。 次に表示されるポップアップに従って「許可」を選択してください。",(0,g.jsx)("button",{type:"button",className:"jsx-1032130567 btn",children:"OK"})]}),(0,g.jsx)(r(),{id:"1032130567",children:[".page-index.jsx-1032130567{width:100%;height:100%;background-color:#555;position:absolute;}",".modal.jsx-1032130567{max-width:320px;padding:16px 32px;background:#fff;position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000;}",".modal.jsx-1032130567 .btn.jsx-1032130567{width:100%;height:40px;background:#000 !important;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:24px auto 0;text-align:center;color:#fff;font-size:1rem;cursor:pointer;}"]})]}):null}},8804:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webAR",function(){return n(5623)}])}},function(e){e.O(0,[737,899,774,888,179],function(){return e(e.s=8804)}),_N_E=e.O()}]);