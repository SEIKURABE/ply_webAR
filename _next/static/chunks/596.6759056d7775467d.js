"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{65596:function(e,n,t){t.r(n);var r=t(50029),a=t(87794),s=t.n(a),o=t(67294),i=t(83165);t(48093);var u=t(85893);n.default=function(e){var n=e.modelUrl,t=(0,o.useRef)(null),a=(0,o.useState)(!1),c=a[0],l=a[1],d=(0,o.useState)(!1),p=d[0],f=d[1],h=(0,o.useRef)(!1),b=(0,o.useRef)(!1),g=(0,o.useRef)(null);return(0,o.useEffect)(function(){if(t.current){var e=new i.D4V(t.current,!0),a=new i.xsS(e),o=null,u=null,c=null;return new i.YfP("camera",Math.PI/2,Math.PI/4,5,i.Pa4.Zero(),a).attachControl(t.current,!0),new i.ezm("light",new i.Pa4(1,1,0),a).intensity=.7,(0,r.Z)(s().mark(function e(){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.n0n.LoadAssetContainerAsync("",n,a);case 2:return o=e.sent,u=new i.YOI("modelRoot",a),e.next=6,a.createDefaultXRExperienceAsync({uiOptions:{sessionMode:"immersive-ar",referenceSpaceType:"local-floor"},optionalFeatures:["hit-test","anchors","plane-detection"]});case 6:(t=e.sent).baseExperience.sessionManager.onXRSessionInit.add(function(){f(!0)}),t.baseExperience.sessionManager.onXRSessionEnded.add(function(){f(!1),l(!1),h.current=!1,b.current=!1,g.current=null}),null!==t.baseExperience.featuresManager.enableFeature(i.iUT,"latest",{createPlaneIndicator:!0,xrInput:t.input,planeIndicatorOptions:{size:.5,color:new i.Wot(.2,.8,.4)}})&&(t.baseExperience.featuresManager.getEnabledFeature("plane-detection").onPlaneAddedObservable.add(function(e){l(!0),h.current=!0}),c=a.onPointerObservable.add(function(e){e.type===i.kD3.POINTERDOWN&&(b.current=!0)})),t.baseExperience.featuresManager.enableFeature(i.KS9,"latest",{enableTransientHitTest:!0,entityTypes:["plane"]}).onHitTestResultObservable.add(function(e){if(e.length>0&&(g.current=e[0],h.current||(l(!0),h.current=!0)),b.current&&g.current&&o&&u){for(b.current=!1;u.getChildren().length>0;)u.getChildren()[0].dispose();o.instantiateModelsToScene(function(e){return e},!1).rootNodes.forEach(function(e){e.parent=u}),u.position.copyFrom(g.current.position),u.rotationQuaternion=g.current.rotationQuaternion.clone(),u.scaling=new i.Pa4(.5,.5,.5)}});case 12:case"end":return e.stop()}},e)}))(),e.runRenderLoop(function(){a.render()}),window.addEventListener("resize",function(){return e.resize()}),function(){e&&(e.stopRenderLoop(),e.dispose()),a&&(c&&a.onPointerObservable.remove(c),a.meshes.forEach(function(e){return e.dispose()}),a.dispose())}}},[n]),(0,u.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,u.jsx)("canvas",{ref:t,style:{width:"100%",height:"100%"}}),p&&!c&&(0,u.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.7)",color:"white",padding:"10px",borderRadius:"5px",textAlign:"center"},children:"周囲の平面をスキャンしてください"})]})}}}]);