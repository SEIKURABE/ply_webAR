(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70],{314:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var i=n(9848),r=n.n(i),o=n(7294),s=n(5029),a=n(7462),c=n(3249),d=n(9477);let u=e=>"function"==typeof e,l=o.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:i,children:r,...s},l)=>{var h;let f=(0,c.z)(({set:e})=>e),v=(0,c.z)(({camera:e})=>e),p=(0,c.z)(({size:e})=>e),m=o.useRef(null),g=o.useRef(null),w=function(e,t,n){let{gl:i,size:r,viewport:s}=(0,c.z)(),a="number"==typeof e?e:r.width*s.dpr,u="number"==typeof t?t:r.height*s.dpr,{samples:l=0,depth:h,...f}=("number"==typeof e?void 0:e)||{},v=o.useMemo(()=>{let e;return e=new d.WebGLRenderTarget(a,u,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,encoding:i.outputEncoding,type:d.HalfFloatType,...f}),h&&(e.depthTexture=new d.DepthTexture(a,u,d.FloatType)),e.samples=l,e},[]);return o.useLayoutEffect(()=>{v.setSize(a,u),l&&(v.samples=l)},[l,v,a,u]),o.useEffect(()=>()=>v.dispose(),[]),v}(t);o.useLayoutEffect(()=>{s.manual||(m.current.aspect=p.width/p.height)},[p,s]),o.useLayoutEffect(()=>{m.current.updateProjectionMatrix()});let b=0,x=null,y=u(r);return(0,c.A)(t=>{y&&(n===1/0||b<n)&&(g.current.visible=!1,t.gl.setRenderTarget(w),x=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,m.current),t.scene.background=x,t.gl.setRenderTarget(null),g.current.visible=!0,b++)}),o.useLayoutEffect(()=>{if(i)return f(()=>({camera:m.current})),()=>f(()=>({camera:v}))},[m,i,f]),o.createElement(o.Fragment,null,o.createElement("perspectiveCamera",(0,a.Z)({ref:(h=[m,l],function(e){h.forEach(function(t){"function"==typeof t?t(e):null!=t&&(t.current=e)})})},s),!y&&r),o.createElement("group",{ref:g},y&&r(w.texture)))});var h=n(1180);class f extends d.EventDispatcher{constructor(e){super(),(0,h.Z)(this,"object",void 0),(0,h.Z)(this,"changeEvent",{type:"change"}),(0,h.Z)(this,"EPS",1e-6),(0,h.Z)(this,"enabled",!0),(0,h.Z)(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),(0,h.Z)(this,"screenOrientation",0),(0,h.Z)(this,"alphaOffset",0),(0,h.Z)(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),(0,h.Z)(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),(0,h.Z)(this,"zee",new d.Vector3(0,0,1)),(0,h.Z)(this,"euler",new d.Euler),(0,h.Z)(this,"q0",new d.Quaternion),(0,h.Z)(this,"q1",new d.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),(0,h.Z)(this,"setObjectQuaternion",(e,t,n,i,r)=>{this.euler.set(n,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-r))}),(0,h.Z)(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),(0,h.Z)(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),(0,h.Z)(this,"lastQuaternion",new d.Quaternion),(0,h.Z)(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?d.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,n=e.beta?d.MathUtils.degToRad(e.beta):0,i=e.gamma?d.MathUtils.degToRad(e.gamma):0,r=this.screenOrientation?d.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,n,i,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),(0,h.Z)(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let v=o.forwardRef((e,t)=>{let{camera:n,onChange:i,makeDefault:r,...s}=e,d=(0,c.z)(e=>e.camera),u=(0,c.z)(e=>e.invalidate),l=(0,c.z)(e=>e.get),h=(0,c.z)(e=>e.set),v=n||d,[p]=o.useState(()=>new f(v));return o.useEffect(()=>{let e=e=>{u(),i&&i(e)};return null==p||null==p.addEventListener||p.addEventListener("change",e),()=>null==p?void 0:null==p.removeEventListener?void 0:p.removeEventListener("change",e)},[i,p,u]),(0,c.A)(()=>null==p?void 0:p.update(),-1),o.useEffect(()=>(null==p||p.connect(),()=>null==p?void 0:p.dispose()),[p]),o.useEffect(()=>{if(r){let e=l().controls;return h({controls:p}),()=>h({controls:e})}},[r,p]),p?o.createElement("primitive",(0,a.Z)({ref:t,object:p},s)):null});function p(e){let t=e+"Geometry";return o.forwardRef(({args:e,children:n,...i},r)=>o.createElement("mesh",(0,a.Z)({ref:r},i),o.createElement(t,{attach:"geometry",args:e}),n))}let m=p("box");p("circle"),p("cone"),p("cylinder"),p("sphere"),p("plane"),p("tube"),p("torus"),p("torusKnot"),p("tetrahedron"),p("ring"),p("polyhedron"),p("icosahedron"),p("octahedron"),p("dodecahedron"),p("extrude"),p("lathe"),p("capsule");var g=n(4970),w=n.n(g),b=n(5893),x=function(){var e=(0,o.useRef)(null),t=(0,o.useState)({width:0,height:0}),n=t[0],i=t[1];return(0,o.useEffect)(function(){var t,n;i({width:Number(null===(t=e.current)||void 0===t?void 0:t.clientWidth),height:Number(null===(n=e.current)||void 0===n?void 0:n.clientHeight)})},[]),(0,b.jsxs)("div",{ref:e,className:"jsx-3916907500 web-camera-container",children:[(0,b.jsx)(w(),{width:n.width,height:n.height,videoConstraints:{width:n.width,height:n.height,facingMode:{exact:"environment"}}}),(0,b.jsx)(r(),{id:"3916907500",children:[".web-camera-container.jsx-3916907500{width:100%;height:100%;background-color:rgba(0,0,255,0.5);}",".video-camera.jsx-3916907500{width:100%;height:100%;position:absolute;inset:0 0 0 0;}"]})]})},y=function(){var e=(0,o.useRef)(null),t=(0,o.useRef)(null),n=(0,o.useState)(!0),i=n[0],a=n[1],c=(0,o.useState)(!1),d=c[0],u=c[1],h=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>=0||e.indexOf("ipad")>=0||e.indexOf("ipod")>=0};(0,o.useEffect)(function(){new Promise(function(e,t){h()||e("resolve"),window.addEventListener("deviceorientation",function t(){window.removeEventListener("deviceorientation",t,!1),e("resolve")},!1)}).then(function(){u(!0),a(!1)}).catch(function(e){console.log(e)})},[]);var f="モーションセンサーの使用が拒否されました。\nこのページを楽しむには、デバイスモーションセンサーの使用を許可する必要があります。\nSafariのアプリを再起動して、モーションセンサーの使用（「動作と方向」へのアクセス）を許可をしてください。",p=(0,o.useState)(!1),g=p[0],w=p[1];return(0,b.jsxs)("div",{className:"jsx-3392093160 page-webar",children:[(0,b.jsxs)("div",{className:"jsx-3392093160 main",children:[d&&(0,b.jsxs)(s.Xz,{ref:e,className:"canvas",children:[(0,b.jsx)(l,{}),(0,b.jsx)(v,{ref:t}),(0,b.jsx)("ambientLight",{intensity:1,className:"jsx-3392093160"}),(0,b.jsx)("axesHelper",{args:[1],className:"jsx-3392093160"}),(0,b.jsx)(o.Suspense,{fallback:null,children:(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(m,{args:[100,100,100,4,4,4],children:[(0,b.jsx)("meshBasicMaterial",{wireframe:!0,className:"jsx-3392093160"}),(0,b.jsx)("axesHelper",{args:[100],className:"jsx-3392093160"})]})})})]}),i&&(0,b.jsxs)("div",{className:"jsx-3392093160 modal",children:["このページでは端末の向きと方向を取得し ます。 次に表示されるポップアップに従って「許可」を選択してください。",(0,b.jsx)("button",{type:"button",onClick:function(){new Promise(function(e,t){window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&"function"==typeof window.DeviceMotionEvent.requestPermission&&window.DeviceMotionEvent.requestPermission().then(function(e){}),window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(function(n){console.log(n),"granted"===n?(u(!0),a(!1),e("resolve")):(alert(f),t("resolve"))}):(alert(f),t("resolve"))})},className:"jsx-3392093160 btn",children:"OK"})]})]}),(0,b.jsx)("div",{className:"jsx-3392093160 background-video",children:g&&(0,b.jsx)(x,{})}),(0,b.jsx)("div",{className:"jsx-3392093160 button-container",children:(0,b.jsx)("button",{type:"button",onClick:function(){w(!g)},className:"jsx-3392093160 "+"active-camera-button ".concat(g?"is-active":""),children:"Active Camera"})}),(0,b.jsx)(r(),{id:"3392093160",children:[".page-webar.jsx-3392093160{width:100%;height:100%;background-color:#555;position:absolute;}",".main.jsx-3392093160{width:100%;height:100%;position:relative;z-index:1;}",".modal.jsx-3392093160{max-width:320px;width:100%;padding:16px 32px;background:#fff;position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000;}",".modal.jsx-3392093160 .btn.jsx-3392093160{width:100%;height:40px;background:#000 !important;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:24px auto 0;text-align:center;color:#fff;font-size:1rem;cursor:pointer;}",".background-video.jsx-3392093160{width:100%;height:100%;position:fixed;top:0;left:0;z-index:0;background-color:rgba(255,0,0,0.5);}",".button-container.jsx-3392093160{position:fixed;bottom:0;left:0;z-index:100;}",".active-camera-button.jsx-3392093160{padding:8px 16px;}"]})]})}},8804:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webAR",function(){return n(314)}])},4970:function(e,t,n){var i;e.exports=(i=n(7294),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,(function(t){return e[t]}).bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var i,r=n(/*! react */"react"),o=(i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(){return(s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function c(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}"undefined"!=typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(n,i){t.call(navigator,e,n,i)}):Promise.reject(Error("getUserMedia is not implemented in this browser"))}));var d=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return o(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;if(this.unmounted=!1,!c()){t.onUserMediaError("getUserMedia not supported");return}e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(!c()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),i=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),r=e.minScreenshotWidth!==t.minScreenshotWidth,o=e.minScreenshotHeight!==t.minScreenshotHeight;(i||r||o)&&(this.canvas=null,this.ctx=null),(n||i)&&(this.stopAndCleanup(),this.requestUserMedia())},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var i=this.getCanvas(e);return i&&i.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video||!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var i=this.video.videoWidth,r=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var o=i/r;r=(i=n.minScreenshotWidth||this.video.clientWidth)/o,n.minScreenshotHeight&&r<n.minScreenshotHeight&&(i=(r=n.minScreenshotHeight)*o)}this.canvas=document.createElement("canvas"),this.canvas.width=(null==e?void 0:e.width)||i,this.canvas.height=(null==e?void 0:e.height)||r,this.ctx=this.canvas.getContext("2d")}var s=this.ctx,a=this.canvas;return s&&a&&(n.mirrored&&(s.translate(a.width,0),s.scale(-1,1)),s.imageSmoothingEnabled=n.imageSmoothing,s.drawImage(this.video,0,0,(null==e?void 0:e.width)||a.width,(null==e?void 0:e.height)||a.height),n.mirrored&&(s.scale(-1,1),s.translate(-a.width,0))),a},t.prototype.requestUserMedia=function(){var e=this,n=this.props,i=function(i,r){var o={video:void 0===r||r};n.audio&&(o.audio=void 0===i||i),e.requestUserMediaId++;var s=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(o).then(function(n){e.unmounted||s!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)}).catch(function(t){e.handleUserMedia(t)})};if("mediaDevices"in navigator)i(n.audioConstraints,n.videoConstraints);else{var r=function(e){return{optional:[{sourceId:e}]}},o=function(e){var t=e.deviceId;return"string"==typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"==typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources(function(e){var t=null,s=null;e.forEach(function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(s=e.id)});var a=o(n.audioConstraints);a&&(t=a);var c=o(n.videoConstraints);c&&(s=c),i(r(t),r(s))})}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(e){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,i=n.audio,o=(n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),c=n.style,d=void 0===c?{}:c,u=n.children,l=a(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),h=o?s(s({},d),{transform:(d.transform||"")+" scaleX(-1)"}):d,f={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",s({autoPlay:!0,src:t.src,muted:!i,playsInline:!0,ref:function(t){e.video=t},style:h},l)),u&&u(f))},t.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=d},react:function(e,t){e.exports=i}}).default)}},function(e){e.O(0,[737,899,774,888,179],function(){return e(e.s=8804)}),_N_E=e.O()}]);